# Case Study по модулю SQL  

Ваша задача - используя SQL, проанализировать данные розничных продаж компании Adventure Works.   

## Блок 1. Создание схемы и таблиц  
1. В базе данных создайте новую схему `adv_works`.  
2. На основе данных из [файла](https://github.com/datacoach2024/data_analysis_course/blob/main/data/adventure_works.xlsx) создайте в схеме `adv_works` таблицы и соедините их между собою по основным и внешним ключам.

## Блок 2. Аналитические задачи  
### Секция 1. Анализ клиентов  
1. **Сегментация по доходу**: Посчитайте средний годовой личный доход клиентов (*YearlyIncome*) в разбивке по роду деятельности (*Occupation*). Итоговая таблица должна содержать следующие поля: *occupation*, *number_of_customers*, *avg_income*.  
2.  **Семейный профиль**: Посчитайте долю (в процентах) клиентов с детьми и долю клиентов без детей. Итоговая таблица должна содержать следующие поля: *has_children* (где 1 означает - имеет детей и 0 - не имеет детей), *pct_of_customer_base*.
3.  **Высокодоходные клиенты**: Сформируйте список топ 10 клиентов с наибольшей суммой покупок (поле `SalesAmount`). Итоговая таблица должна содержать следующие поля: *customer_key*, *customer_name*, *total_purchase*.
4.  **Влияние семейного положения**: Посчитайте среднюю сумму продаж в разбивке по семейному положению клиентов (*MaritalStatus*) и определите насколько сильно различаются средние суммы между двумя группами. Итоговая таблица должна содержать следующие поля: *year*, *marital_status*, *avg_sales_amount*.  

 ### Секция 2. Анализ продаж  
 1. **Ежемесячные продажи**: Создайте отчёт продаж по месяцам за последние 2 года (2003, 2004). Итоговая таблица должна содержать следующие поля: *year*, *monthkey*, *month_name*, *sales_count* (количество продаж), *sales_amount*.  
 2. **Продажи по регионам**: Посчитайте сумму продаж в разбивке по регионам. Итоговая таблица должна содержать следующие поля: *region*, *sales_count*, *sales_amount*.  
 
 ### Секция 3. Анализ продуктов  
 1. **Доля продаж**: Посчитайте какую долю от общих продаж составляет каждая категория продуктов. Итоговая таблица должна содержать следующие поля: *year*, *product_key*, *product_category_key*, *english_product_category_name*, *sales_amount*, *pct_of_total_sales*.
 2. **Самые продаваемые продукты**: Определите топ 5 продуктов с наибольшей суммой продаж. Итоговая таблица должна содержать следующие поля: *product_key*, *product_name*, *english_product_category_name*, *sales_amount*
 3. **Маржа от продаж**: Посчитайте разницу между суммой продаж (*SalesAmount*) за минусом себестоимости (*TotalProductCost*), налогов (*TaxAmt) и расходов на доставку (*Freight*) по каждому продукту в разбивке по годам и месяцам. Итоговая таблица должна содержать следующие поля: *year*, *monthkey*, *month_name*, *product_key*, *product_name*, *sales_amount*, *total_product_cost*, *tax_amt*, *freight*, *margin*, *margin_pct* (маржа как процент от суммы продаж).

### Секция 4. Анализ трендов  
1. **Квартальный рост**: Посчитайте сумму продаж за каждый квартал и их процентное изменение по топ 2 наиболее продаваемым категориям. Итоговая таблица должна содержать следующие поля: *year*, *quarter_id*, *product_category_key*, *english_product_category_name*, *quarter_sales_amount*, *quarter_over_quarter_growth_pct*.
2. **Сравнение будних и выходных (суббота, воскресенье) дней**: Посчитайте продажи в разбивке по годам и дням недели. Определите в какие дни в среднем сумма продаж больше. Определите является ли сумма продаж больше в будние или выходные дни. Итоговая таблица должна содержать следующие поля: *year*, *day_name*, *is_weekend* (где 1 означает выходной а 0 будний день), *sales_amount*.

---  

Решение должно быть в формате `jupyter notebook`. Файл должен называться `sql_case_study.ipynb`.    
Ноутбук должен содержать заголовок **Case Study по модулю SQL**, имя и фамилию исполнителя и дату исполнения.    

>Все операции связанные с анализом должны производиться только с помощью **SQL**.  
>Использовать **Python** можно только для:  
> * создания подключения,
> * запуска скриптов создания схемы и таблиц,
> * чтения данных из файла MS Excel и записи этих данных в таблицы в базе данных,
> * получения и отображения результатов SQL-запроса в виде датафрейма

Структура ноутбука должна быть следующей:  
* название блока
* название секции (если есть)
* описание задачи  
* код решения
* ваши выводы по полученным результатам

---  
Создайте файл `summary_report.md`. В этом файле напишите аналитическую записку по резултатам проведённого анализа. Вам нужно описать что вы сделали, какие результаты получили и к каким выводам пришли.  Используйте markdown разметку.  

---  
Создайте в вашем репозитории новую ветку и сохраните оба файла (`sql_case_study.ipynb`, `summary_report.md`). Сделайте соответствующие коммиты, пуш и создайте pull request. В классруме прикрепите скриншот вкладки `files changed` вашего pull request-а.
